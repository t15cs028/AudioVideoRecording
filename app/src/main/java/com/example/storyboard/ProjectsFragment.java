package com.example.storyboard;import android.graphics.Bitmap;import android.graphics.BitmapFactory;import android.os.Bundle;import android.support.annotation.NonNull;import android.support.annotation.Nullable;import android.support.v4.app.Fragment;import android.support.v4.app.FragmentManager;import android.support.v4.app.FragmentTransaction;import android.view.LayoutInflater;import android.view.View;import android.view.ViewGroup;import android.widget.AdapterView;import android.widget.ListView;import com.example.camera.R;import com.example.database.DBHelper;import com.example.database.Project;import com.example.database.Table;import com.example.dialog.BlockDialogFragment;import java.util.ArrayList;public class ProjectsFragment extends Fragment {    private DBHelper dbHelper;    private View rootView;    /*    private ViewGroup container;    */    public static ProjectsFragment newInstance(DBHelper dbHelper){        ProjectsFragment fragment = new ProjectsFragment();        fragment.dbHelper = dbHelper;        return fragment;    }    public ProjectsFragment() {    }    @Override    public void onCreate(Bundle saveInstanceState){        super.onCreate(saveInstanceState);        setRetainInstance(true);    }    @Nullable    @Override    public View onCreateView(@NonNull LayoutInflater inflater, @Nullable ViewGroup container,                             @Nullable Bundle savedInstanceState) {        rootView = inflater.inflate(R.layout.projects_main, container, false);        return rootView;    }    @Override    public void onActivityCreated(Bundle savedInstanceState) {        super.onActivityCreated(savedInstanceState);        String name[] = dbHelper.getColumn(Table.PROJECT, Project.NAME.getName());        if (name != null){            ArrayList<StoryList> listItem = new ArrayList<>();            ListView list = (ListView) rootView.findViewById(R.id.sample_listview);            Bitmap bmp = BitmapFactory.decodeResource(getResources(),                    R.drawable.ic_launcher_round);            for(int i = 0; i < name.length; i++) {                StoryList block = new StoryList(i, name[i], bmp);                listItem.add(block);            }            StoryListAdapter adapter =                    new StoryListAdapter(getActivity(), R.layout.liststories_main, listItem);            list.setAdapter(adapter);            list.setOnItemClickListener(onItemClickListener);            list.setOnItemLongClickListener(onItemLongClickListener);        }    }    private AdapterView.OnItemClickListener onItemClickListener = new AdapterView.OnItemClickListener() {        @Override        public void onItemClick(AdapterView<?> parent, View view, int position, long id) {          // タッチされた絵コンテ作品のIDを取得            String projectIDs[] = dbHelper.getColumn(Table.PROJECT, Project.ID.getName());            int projectID = Integer.parseInt(projectIDs[position]);            FragmentManager fragmentManager = getFragmentManager();            if (fragmentManager != null) {                FragmentTransaction fragmentTransaction = fragmentManager.beginTransaction();                // BackStackを設定                fragmentTransaction.addToBackStack(null);                ProjectFragment projectFragment = ProjectFragment.newInstance(dbHelper, projectID);                fragmentTransaction.replace(R.id.container, projectFragment);                fragmentTransaction.commit();            }        }    };    // リストをロングクリックしたときの動作    private AdapterView.OnItemLongClickListener onItemLongClickListener            = new AdapterView.OnItemLongClickListener(){        @Override        public boolean onItemLongClick(AdapterView<?> parent, View view, int position, long id){            final BlockDialogFragment dialog = BlockDialogFragment.newInstance(dbHelper);            dialog.setTargetFragment(null, 100);            dialog.show(getChildFragmentManager(), "my_dialog");            return true;        }    };}