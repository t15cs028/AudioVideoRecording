package com.example.storyboard;import android.os.Bundle;import android.support.v4.app.Fragment;import android.support.v4.app.FragmentManager;import android.support.v4.app.FragmentTransaction;import android.text.SpannableStringBuilder;import android.view.LayoutInflater;import android.view.View;import android.view.ViewGroup;import android.widget.Button;import android.widget.EditText;import android.widget.Toast;import com.example.camera.R;import com.example.database.DBHelper;import com.example.database.Project;import com.example.database.Table;public class NewProjectFragment extends Fragment {    private DBHelper dbHelper;    private View rootView;    public static NewProjectFragment newInstance(DBHelper dbHelper){        NewProjectFragment fragment = new NewProjectFragment();        fragment.dbHelper = dbHelper;        return fragment;    }    public NewProjectFragment(){    }    @Override    public void onCreate(Bundle saveInstanceState){        super.onCreate(saveInstanceState);        setRetainInstance(true);    }    @Override    public View onCreateView(final LayoutInflater inflater, final ViewGroup container,                             final Bundle savedInstanceState) {        rootView = inflater.inflate(R.layout.newstory_main, container, false);        return rootView;    }    @Override    public void onViewCreated(View view, Bundle savedInstanceState) {        super.onViewCreated(view, savedInstanceState);        Button button = (Button) view.findViewById(R.id.enter);        final EditText text = (EditText) view.findViewById(R.id.name);        button.setOnClickListener(new View.OnClickListener(){            @Override            public void onClick(View view) {                String date = dbHelper.getNowDateTime();                SpannableStringBuilder sb = (SpannableStringBuilder) text.getText();                String [] str = new String [] {                        "id",                        date,                        sb.toString(),                        "new"                };                // 名前の入力なし                if (str[Project.NAME.getNumber()].length() == 0) {                    showError("Please input name!");                }                // 既に名前が存在する                else if(dbHelper.existProjectName(str[Project.NAME.getNumber()])) {                    showError("This name Block exist. Try again other name...");                }                else {                    // データをセットする                    // 登録時にエラーが起きた                    if(!dbHelper.setRecord(Table.PROJECT, str)){                        showError("error : Please try again...");                    }                    // 登録が成功した                    else {                        // テーブルに新しく挿入したデータのプライマリーキーを取得                        String [] ids = dbHelper.getColumn(Table.PROJECT, Project.ID.getName(),                                Project.DATE.getName(), date);                        int id = 0;                        for(String s :ids){                            id = Integer.parseInt(s);                        }                        FragmentManager fragmentManager = getFragmentManager();                        if (fragmentManager != null) {                            fragmentManager.popBackStack();                            if (fragmentManager != null) {                                FragmentTransaction fragmentTransaction = fragmentManager.beginTransaction();                                // BackStackを設定                                fragmentTransaction.addToBackStack(null);                                ProjectFragment projectFragment = ProjectFragment.newInstance(dbHelper, id);                                fragmentTransaction.replace(R.id.container, projectFragment);                                fragmentTransaction.commit();                            }                        }                    }                }            }        });    }    /*     * エラー等のToastを表示する     * str : 表示したいString     */    public void showError(String str){        Toast toast = Toast.makeText(getActivity(), str, Toast.LENGTH_SHORT);        toast.show();    }}